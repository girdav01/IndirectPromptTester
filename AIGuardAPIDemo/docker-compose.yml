version: '3.8'

services:
  # Base service for all demos
  demo-base:
    build:
      context: .
      dockerfile: Dockerfile
    env_file:
      - .env
    volumes:
      - .:/app
    working_dir: /app

  # LLM01: Prompt Injection Demo
  demo-llm01:
    extends: demo-base
    container_name: aigiard-demo-llm01
    command: python demos/llm01_prompt_injection/demo.py
    ports:
      - "8001:8000"

  # LLM02: Sensitive Information Disclosure Demo
  demo-llm02:
    extends: demo-base
    container_name: aigiard-demo-llm02
    command: python demos/llm02_sensitive_info/demo.py
    ports:
      - "8002:8000"

  # LLM06: Excessive Agency Demo
  demo-llm06:
    extends: demo-base
    container_name: aigiard-demo-llm06
    command: python demos/llm06_excessive_agency/demo.py
    ports:
      - "8006:8000"

  # Interactive Jupyter environment for demos
  jupyter:
    extends: demo-base
    container_name: aigiard-jupyter
    command: jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root
    ports:
      - "8888:8888"
    environment:
      - JUPYTER_ENABLE_LAB=yes

  # LiteLLM Proxy with AI Guard middleware
  litellm-proxy:
    extends: demo-base
    container_name: aigiard-litellm-proxy
    command: litellm --config /app/integrations/litellm/config.yaml
    ports:
      - "4000:4000"
    environment:
      - PORT=4000

  # Development environment with hot reload
  dev:
    extends: demo-base
    container_name: aigiard-dev
    command: python -m pytest tests/ -v --watch
    volumes:
      - .:/app
      - /app/.venv  # Exclude venv from sync

networks:
  default:
    name: aigiard-network
